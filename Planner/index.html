<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Planner</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="base.css">
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="components.css">
    <link rel="stylesheet" href="pages.css">
    <link rel="stylesheet" href="textEditor.css">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1 class="brand">My Planner</h1>
                <p class="tagline">ORGANIZED & PRODUCTIVE</p>
            </div>

            <nav class="nav-menu">
                <button class="nav-item active" data-section="tasks">
                    <svg class="nav-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M6 10l2 2 6-6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                        <rect x="3" y="3" width="14" height="14" rx="2" stroke="currentColor" stroke-width="1.5" />
                    </svg>
                    <span>Tasks</span>
                </button>
                <button class="nav-item" data-section="shopping">
                    <svg class="nav-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <circle cx="8" cy="17" r="1.5" fill="currentColor" />
                        <circle cx="16" cy="17" r="1.5" fill="currentColor" />
                        <path d="M1 1h3l2.68 11.39a1 1 0 001 .61h9.72a1 1 0 001-.78l1.5-7.5A1 1 0 0019 3H6"
                            stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <span>To-Buy</span>
                </button>
                <button class="nav-item" data-section="ideas">
                    <svg class="nav-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <circle cx="10" cy="12" r="3" stroke="currentColor" stroke-width="1.5" />
                        <path d="M10 2v3M10 15v3M4 6l2 2M14 12l2 2M2 10h3M15 10h3M4 14l2-2M14 8l2-2"
                            stroke="currentColor" stroke-width="1.5" />
                    </svg>
                    <span>Ideas</span>
                </button>
                <button class="nav-item" data-section="notes">
                    <svg class="nav-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <rect x="4" y="3" width="12" height="14" rx="2" stroke="currentColor" stroke-width="1.5" />
                        <path d="M7 7h6M7 10h6M7 13h3" stroke="currentColor" stroke-width="1.5"
                            stroke-linecap="round" />
                    </svg>
                    <span>Notes</span>
                </button>
                <button class="nav-item" data-section="events">
                    <svg class="nav-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <circle cx="10" cy="10" r="7" stroke="currentColor" stroke-width="1.5" />
                        <path d="M10 6v4l3 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                    </svg>
                    <span>Events</span>
                </button>
                <button class="nav-item" data-section="habits">
                    <svg class="nav-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M3 10L7 14L17 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M14 3L15 2M17 5L18 4M17 2L18 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                    <span>Habits</span>
                </button>
                <button class="nav-item" data-section="calendar">
                    <svg class="nav-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <rect x="3" y="4" width="14" height="14" rx="2" stroke="currentColor" stroke-width="1.5" />
                        <path d="M3 8h14M7 2v4M13 2v4" stroke="currentColor" stroke-width="1.5" />
                    </svg>
                    <span>Calendar</span>
                </button>
                <button class="nav-item" data-section="routine">
                    <svg class="nav-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <circle cx="10" cy="10" r="7" stroke="currentColor" stroke-width="1.5"/>
                        <path d="M10 5v5l3 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        <path d="M10 2v1M10 17v1M2 10h1M17 10h1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                    <span>Routine</span>
                </button>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            
            <!-- Tasks Section -->
            <section class="section active" id="tasks">
                <h2 class="section-title">Tasks</h2>

                <!-- Filter Buttons -->
                <div id="taskFilters" class="filter-container"></div>

                <div class="add-item-box">
                    <div class="bt-container">
                        <label class="add-title">TASK NAME</label>
                        <input type="text" class="add-input" placeholder="What needs to be done?" id="taskInput">
                    </div>

                    <div class="bt-container">
                        <label class="add-title">ANY DUE DATE?</label>
                        <input type="date" class="add-input" id="taskDate">
                    </div>

                    <div class="bt-container">
                        <label class="add-title">CATEGORY</label>
                        <select class="add-select" id="taskCategory">
                            <option value="personal">Personal</option>
                            <option value="work">Work</option>
                            <option value="health">Health</option>
                            <option value="relationship">Relationship</option>
                            <option value="family">Family</option>
                        </select>
                    </div>

                    <div class="buttons">
                        <div class="bt-container">
                            <label class="add-title">CREATE TASK!</label>
                            <button class="add-btn" onclick="addTask()">+ Add</button>
                        </div>
                        <div class="bt-container">
                            <label class="add-title">MANAGE CATEGORIES</label>
                            <button class="add-btn btn-secondary" onclick="openTaskCategoryModal()">+ Category</button>
                        </div>
                    </div>
                </div>
                <div class="items-list" id="tasksList"></div>
            </section>

            <!-- To-buy Section -->
            <section class="section" id="shopping">
                <h2 class="section-title">To-Buy List</h2>

                <!-- Filter Buttons -->
                <div id="shoppingFilters" class="filter-container"></div>

                <div class="add-item-box">
                    <div class="bt-container">
                        <label class="add-title">ITEM NAME</label>
                        <input type="text" class="add-input" placeholder="What do you need to buy?" id="shoppingInput">
                    </div>

                    <div class="bt-container">
                        <label class="add-title">CATEGORY</label>
                        <select class="add-select" id="shoppingCategory">
                            <option value="">No Category</option>
                            <option value="groceries">Groceries</option>
                            <option value="household">Household</option>
                            <option value="electronics">Electronics</option>
                            <option value="clothing">Clothing</option>
                            <option value="books">Books</option>
                        </select>
                    </div>

                    <div class="buttons">
                        <div class="bt-container">
                            <label class="add-title">ADD TO LIST</label>
                            <button class="add-btn" onclick="addShoppingItem()">+ Add</button>
                        </div>
                        <div class="bt-container">
                            <label class="add-title">MANAGE CATEGORIES</label>
                            <button class="add-btn btn-secondary" onclick="openShoppingCategoryModal()">+ Category</button>
                        </div>
                    </div>
                </div>

                <div class="items-list" id="shoppingList"></div>
            </section>

            <!-- Ideas Section -->
            <section class="section" id="ideas">
                <h2 class="section-title">Ideas</h2>

                <div id="ideaFilters" class="filter-container"></div>

                <!-- UPDATED: New ideas form layout with spacing -->
                <div class="add-item-box ideas-form">
                    <!-- Title Block -->
                    <div class="bt-container">
                        <label class="add-title">ANY GOOD IDEAS TODAY?</label>
                        <input type="text" class="add-input" placeholder="Idea title..." id="ideaTitleInput">
                    </div>

                    <!-- Text Block with Rich Editor -->
                    <div class="bt-container">
                        <label class="add-title">DESCRIBE YOUR IDEA</label>
                        
                        <div class="editor-toolbar">
                            <button type="button" class="editor-btn" onclick="formatText('bold')" title="Bold (Ctrl+B)">
                                <strong>B</strong>
                            </button>
                            <button type="button" class="editor-btn" onclick="formatText('italic')" title="Italic (Ctrl+I)">
                                <em>I</em>
                            </button>
                            <button type="button" class="editor-btn" onclick="formatText('underline')" title="Underline (Ctrl+U)">
                                <u>U</u>
                            </button>
                            
                            <div class="editor-separator"></div>
                            
                            <button type="button" class="editor-btn" onclick="formatHeading('h1')" title="Heading 1">
                                H1
                            </button>
                            <button type="button" class="editor-btn" onclick="formatHeading('h2')" title="Heading 2">
                                H2
                            </button>
                            
                            <div class="editor-separator"></div>
                            
                            <button type="button" class="editor-btn" onclick="formatText('insertUnorderedList')" title="Bullet List">
                                • List
                            </button>
                            <button type="button" class="editor-btn" onclick="formatText('insertOrderedList')" title="Numbered List">
                                1. List
                            </button>
                            
                            <div class="editor-separator"></div>
                            
                            <button type="button" class="editor-btn" onclick="clearFormatting()" title="Clear Formatting">
                                Clear
                            </button>
                        </div>
                        
                        <div 
                            id="ideaRichEditor" 
                            class="editor-content" 
                            contenteditable="true" 
                            data-placeholder="Share your idea with rich formatting..."
                        ></div>
                    </div>

                    <!-- Category and Buttons Block -->
                    <div style="display: grid; grid-template-columns: 1fr; gap: 1rem;">
                        <div class="bt-container">
                            <label class="add-title">CATEGORY</label>
                            <select class="add-select" id="ideaCategory">
                                <option value="personal">Personal</option>
                                <option value="work">Work</option>
                                <option value="study">Study</option>
                                <option value="relationships">Relationships</option>
                                <option value="creative">Creative</option>
                            </select>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="bt-container">
                                <label class="add-title">CREATE IT!</label>
                                <button class="add-btn" onclick="addIdea()">+ Add</button>
                            </div>
                            <div class="bt-container">
                                <label class="add-title">MANAGE CATEGORIES</label>
                                <button class="add-btn btn-secondary" onclick="openCategoryModal()">+ Category</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="ideas-grid" id="ideasGrid"></div>
            </section>

            <!-- Notes Section -->
            <section class="section" id="notes">
                <div class="notes-header">
                    <h2 class="section-title">Notes</h2>
                    <button class="new-note-btn" onclick="openNoteModal()">+ New Note</button>
                </div>

                <div class="notes-list" id="notesList"></div>
            </section>

            <!-- Calendar Section -->
            <section class="section" id="calendar">
                <h2 class="section-title">Calendar</h2>

                <div class="calendar-container" id="calendarContainer">
                    <!-- Calendar views will be rendered here -->
                </div>

                <div class="day-events-modal" id="dayEventsModal">
                    <div class="day-events-overlay" onclick="closeDayEvents()"></div>
                    <div class="day-events-box">
                        <div class="day-events-header">
                            <h3 id="dayEventsTitle"></h3>
                            <button class="modal-close" onclick="closeDayEvents()">×</button>
                        </div>
                        <div class="day-events-body" id="dayEventsBody"></div>
                    </div>
                </div>
            </section>

            <!-- Events Section -->
            <section class="section" id="events">
                <h2 class="section-title">Events</h2>

                <div class="add-item-box">
                    <div class="bt-container">
                        <h3 class="add-title">ADD EVENT</h3>
                        <input type="text" class="add-input" placeholder="Event name" id="eventInput">
                    </div>
                    <div class="bt-container">
                        <h3 class="add-title">DATE AND TIME</h3>
                        <input type="datetime-local" class="add-input" id="eventDate">
                    </div>
                    <div class="bt-container">
                        <h3 class="add-title">WHERE?</h3>
                        <input type="text" class="add-input" placeholder="Location" id="eventLocation">
                    </div>
                    <div class="bt-container">
                        <h3 class="add-title">ANYTHING ELSE?</h3>
                        <input type="text" class="add-input" placeholder="Notes" id="eventNotes">
                    </div>
                    <div class="bt-container">
                        <h3 class="add-title">CREATE IT!</h3>
                        <button class="add-btn" onclick="addEvent()">+ Add</button>
                    </div>
                </div>

                <div class="items-list" id="eventsList"></div>
            </section>

            <!-- Habits Section -->
            <section class="section" id="habits">
                <h2 class="section-title">Habits Tracker</h2>

                <div id="habitFilters" class="filter-container"></div>

                <div class="add-item-box" style="display: grid; grid-template-columns: 1fr 1.5fr 1fr; gap: 1.5rem;">
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <div class="bt-container">
                            <label class="add-title">HABIT NAME</label>
                            <input type="text" class="add-input habit-name-input" placeholder="e.g., Exercise, Read, Meditate..." id="habitInput">
                        </div>

                        <div class="bt-container">
                            <label class="add-title">CATEGORY</label>
                            <select class="add-select" id="habitCategory">
                                <option value="">No category</option>
                                <option value="health">Health</option>
                                <option value="productivity">Productivity</option>
                                <option value="personal">Personal</option>
                                <option value="learning">Learning</option>
                                <option value="social">Social</option>
                            </select>
                        </div>

                        <div class="bt-container">
                            <label class="add-title">SUB-HABITS (OPTIONAL)</label>
                            <textarea class="add-input" id="habitSubHabits" 
                                placeholder="Enter each sub-habit on a new line&#10;Cup 1&#10;Cup 2&#10;Cup 3"
                                rows="4"
                                style="resize: vertical; font-family: inherit; padding: 0.875rem 1rem; line-height: 1.5;"
                            ></textarea>
                        </div>
                    </div>

                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <div class="bt-container">
                            <label class="add-title">FREQUENCY</label>
                            <select class="add-select" id="habitFrequency" onchange="updateDaySelectionVisibility()">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                            </select>
                        </div>

                        <div id="daySelector" class="day-selector-inline" style="display: block;">
                            <div class="day-selector-header">
                                <span class="day-selector-title">Select Days</span>
                                <span class="select-all-days" onclick="toggleAllDays(true)">Select All</span>
                            </div>
                            <div class="day-checkboxes-inline">
                                <input type="checkbox" id="day-sun" class="day-checkbox" value="sun">
                                <label for="day-sun" class="day-checkbox-label">
                                    <span class="day-name">Sun</span>
                                </label>
                                <input type="checkbox" id="day-mon" class="day-checkbox" value="mon">
                                <label for="day-mon" class="day-checkbox-label">
                                    <span class="day-name">Mon</span>
                                </label>
                                <input type="checkbox" id="day-tue" class="day-checkbox" value="tue">
                                <label for="day-tue" class="day-checkbox-label">
                                    <span class="day-name">Tue</span>
                                </label>
                                <input type="checkbox" id="day-wed" class="day-checkbox" value="wed">
                                <label for="day-wed" class="day-checkbox-label">
                                    <span class="day-name">Wed</span>
                                </label>
                                <input type="checkbox" id="day-thu" class="day-checkbox" value="thu">
                                <label for="day-thu" class="day-checkbox-label">
                                    <span class="day-name">Thu</span>
                                </label>
                                <input type="checkbox" id="day-fri" class="day-checkbox" value="fri">
                                <label for="day-fri" class="day-checkbox-label">
                                    <span class="day-name">Fri</span>
                                </label>
                                <input type="checkbox" id="day-sat" class="day-checkbox" value="sat">
                                <label for="day-sat" class="day-checkbox-label">
                                    <span class="day-name">Sat</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="buttons" style="display: flex; flex-direction: column; gap: 1rem; align-items: stretch;">
                        <div class="bt-container">
                            <label class="add-title">START TRACKING</label>
                            <button class="add-btn" style="min-width: 80px;" onclick="addHabit()">+ Add</button>
                        </div>
                        <div class="bt-container">
                            <label class="add-title">MANAGE CATEGORIES</label>
                            <button class="add-btn btn-secondary" style="min-width: 80px;" onclick="openHabitCategoryModal()">+ Category</button>
                        </div>
                    </div>
                </div>

                <div id="habitsList"></div>
            </section>

            <!-- Routine Section -->
            <section class="section" id="routine">
                <h2 class="section-title">My Routine</h2>

                <div class="add-item-box" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 2rem;">
                    <!-- Column 1: Activity Name and Days -->
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <div class="bt-container">
                            <label class="add-title">ACTIVITY NAME</label>
                            <input type="text" class="add-input routine-name-input" placeholder="e.g., Work, Morning Class, Gym..." id="routineInput">
                        </div>

                        <div class="bt-container">
                            <label class="add-title">DAYS OF THE WEEK</label>
                            <select class="add-select" id="routineFrequency" onchange="updateRoutineDaySelectionVisibility()">
                                <option value="specific">Specific Days</option>
                                <option value="everyday">Every Day</option>
                                <option value="weekdays">Weekdays</option>
                                <option value="weekends">Weekends</option>
                            </select>
                        </div>
                    </div>

                    <!-- Column 2: Start Time and End Time -->
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <div class="bt-container">
                            <label class="add-title">START TIME</label>
                            <input type="time" class="add-input routine-time-input" id="routineStartTime">
                        </div>

                        <div class="bt-container">
                            <label class="add-title">END TIME</label>
                            <input type="time" class="add-input routine-time-input" id="routineEndTime">
                        </div>
                    </div>

                    <!-- Column 3: Day Selector -->
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <div id="routineDaySelector" class="day-selector-inline" style="display: block;">
                            <div class="day-selector-header">
                                <span class="day-selector-title">Select Days</span>
                                <span class="select-all-days" onclick="toggleAllRoutineDays(true)">Select All</span>
                            </div>
                            <div class="day-checkboxes-inline">
                                <input type="checkbox" id="routine-day-sun" class="day-checkbox routine-day-checkbox" value="sun">
                                <label for="routine-day-sun" class="day-checkbox-label">
                                    <span class="day-name">Sun</span>
                                </label>
                                <input type="checkbox" id="routine-day-mon" class="day-checkbox routine-day-checkbox" value="mon">
                                <label for="routine-day-mon" class="day-checkbox-label">
                                    <span class="day-name">Mon</span>
                                </label>
                                <input type="checkbox" id="routine-day-tue" class="day-checkbox routine-day-checkbox" value="tue">
                                <label for="routine-day-tue" class="day-checkbox-label">
                                    <span class="day-name">Tue</span>
                                </label>
                                <input type="checkbox" id="routine-day-wed" class="day-checkbox routine-day-checkbox" value="wed">
                                <label for="routine-day-wed" class="day-checkbox-label">
                                    <span class="day-name">Wed</span>
                                </label>
                                <input type="checkbox" id="routine-day-thu" class="day-checkbox routine-day-checkbox" value="thu">
                                <label for="routine-day-thu" class="day-checkbox-label">
                                    <span class="day-name">Thu</span>
                                </label>
                                <input type="checkbox" id="routine-day-fri" class="day-checkbox routine-day-checkbox" value="fri">
                                <label for="routine-day-fri" class="day-checkbox-label">
                                    <span class="day-name">Fri</span>
                                </label>
                                <input type="checkbox" id="routine-day-sat" class="day-checkbox routine-day-checkbox" value="sat">
                                <label for="routine-day-sat" class="day-checkbox-label">
                                    <span class="day-name">Sat</span>
                                </label>
                            </div>
                        </div>

                        <!-- Add to Routine Button -->
                        <div class="bt-container">
                            <label class="add-title">ADD TO ROUTINE</label>
                            <button class="add-btn" onclick="addRoutine()">+ Add</button>
                        </div>
                    </div>
                </div>

                <div class="items-list" id="routineList"></div>
            </section>
        </main>
    </div>

    <!-- Note Modal -->
    <div class="modal" id="noteModal" data-edit-id="">
        <div class="modal-overlay" onclick="closeNoteModal()"></div>
        <div class="modal-box">
            <div class="modal-header">
                <h3 id="noteModalTitle">New Note</h3>
                <button class="modal-close" onclick="closeNoteModal()">×</button>
            </div>
            <div class="modal-body">
                <input type="text" class="note-title-input" placeholder="Note title" id="noteTitle">
                <textarea class="note-content-input" placeholder="Write your note..." id="noteContent"></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeNoteModal()">Cancel</button>
                <button class="btn-save" id="saveNoteBtn" onclick="handleSaveNote()">Save Note</button>
            </div>
        </div>
    </div>

    <!-- ADDED: Task Edit Modal -->
    <div class="modal" id="taskEditModal">
        <div class="modal-overlay" onclick="closeTaskEditModal()"></div>
        <div class="modal-box">
            <div class="modal-header">
                <h3>Edit Task</h3>
                <button class="modal-close" onclick="closeTaskEditModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="edit-form-group">
                    <label>TASK NAME</label>
                    <input type="text" id="editTaskInput" placeholder="What needs to be done?">
                </div>
                <div class="edit-form-group">
                    <label>DUE DATE</label>
                    <input type="date" id="editTaskDate">
                </div>
                <div class="edit-form-group">
                    <label>CATEGORY</label>
                    <select id="editTaskCategory"></select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeTaskEditModal()">Cancel</button>
                <button class="btn-save" onclick="saveTaskEdit()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- ADDED: Shopping Edit Modal -->
    <div class="modal" id="shoppingEditModal">
        <div class="modal-overlay" onclick="closeShoppingEditModal()"></div>
        <div class="modal-box">
            <div class="modal-header">
                <h3>Edit Shopping Item</h3>
                <button class="modal-close" onclick="closeShoppingEditModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="edit-form-group">
                    <label>ITEM NAME</label>
                    <input type="text" id="editShoppingInput" placeholder="What do you need to buy?">
                </div>
                <div class="edit-form-group">
                    <label>CATEGORY</label>
                    <select id="editShoppingCategory"></select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeShoppingEditModal()">Cancel</button>
                <button class="btn-save" onclick="saveShoppingEdit()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- ADDED: Idea Edit Modal -->
    <div class="modal" id="ideaEditModal">
        <div class="modal-overlay" onclick="closeIdeaEditModal()"></div>
        <div class="modal-box">
            <div class="modal-header">
                <h3>Edit Idea</h3>
                <button class="modal-close" onclick="closeIdeaEditModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="edit-form-group">
                    <label>IDEA TITLE</label>
                    <input type="text" id="editIdeaTitleInput" placeholder="Idea title...">
                </div>
                <div class="edit-form-group">
                    <label>DESCRIBE YOUR IDEA</label>
                    
                    <div class="editor-toolbar">
                        <button type="button" class="editor-btn" onclick="formatEditText('bold')" title="Bold">
                            <strong>B</strong>
                        </button>
                        <button type="button" class="editor-btn" onclick="formatEditText('italic')" title="Italic">
                            <em>I</em>
                        </button>
                        <button type="button" class="editor-btn" onclick="formatEditText('underline')" title="Underline">
                            <u>U</u>
                        </button>
                        <div class="editor-separator"></div>
                        <button type="button" class="editor-btn" onclick="formatEditHeading('h1')" title="Heading 1">
                            H1
                        </button>
                        <button type="button" class="editor-btn" onclick="formatEditHeading('h2')" title="Heading 2">
                            H2
                        </button>
                        <div class="editor-separator"></div>
                        <button type="button" class="editor-btn" onclick="formatEditText('insertUnorderedList')" title="Bullet List">
                            • List
                        </button>
                        <button type="button" class="editor-btn" onclick="formatEditText('insertOrderedList')" title="Numbered List">
                            1. List
                        </button>
                        <div class="editor-separator"></div>
                        <button type="button" class="editor-btn" onclick="clearEditFormatting()" title="Clear Formatting">
                            Clear
                        </button>
                    </div>
                    
                    <div 
                        id="editIdeaRichEditor" 
                        class="editor-content" 
                        contenteditable="true" 
                        data-placeholder="Share your idea with rich formatting..."
                    ></div>
                </div>
                <div class="edit-form-group">
                    <label>CATEGORY</label>
                    <select id="editIdeaCategory"></select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeIdeaEditModal()">Cancel</button>
                <button class="btn-save" onclick="saveIdeaEdit()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- ADDED: Event Edit Modal -->
    <div class="modal" id="eventEditModal">
        <div class="modal-overlay" onclick="closeEventEditModal()"></div>
        <div class="modal-box">
            <div class="modal-header">
                <h3>Edit Event</h3>
                <button class="modal-close" onclick="closeEventEditModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="edit-form-group">
                    <label>EVENT NAME</label>
                    <input type="text" id="editEventInput" placeholder="Event name">
                </div>
                <div class="edit-form-group">
                    <label>DATE AND TIME</label>
                    <input type="datetime-local" id="editEventDate">
                </div>
                <div class="edit-form-group">
                    <label>LOCATION</label>
                    <input type="text" id="editEventLocation" placeholder="Location">
                </div>
                <div class="edit-form-group">
                    <label>NOTES</label>
                    <textarea id="editEventNotes" placeholder="Notes"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeEventEditModal()">Cancel</button>
                <button class="btn-save" onclick="saveEventEdit()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div class="modal" id="categoryModal">
        <div class="modal-overlay" onclick="closeCategoryModal()"></div>
        <div class="modal-box modal-box-large">
            <div class="modal-header">
                <h3>Manage Idea Categories</h3>
                <button class="modal-close" onclick="closeCategoryModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="category-form-section">
                    <h4 style="margin-bottom: 1rem; font-size: 0.9rem; font-weight: 600; color: var(--text-secondary);">ADD NEW CATEGORY</h4>
                    <input type="text" class="note-title-input" placeholder="Category name" id="categoryName">
                    <label style="display: block; margin-top: 1rem; margin-bottom: 0.5rem; font-weight: 500;">Choose a color:</label>
                    <input type="color" id="categoryColor" value="#e9d5ff"
                        style="width: 100%; height: 50px; border-radius: 8px; border: 1px solid var(--border-color); cursor: pointer;">
                    <button class="btn-save" style="width: 100%; margin-top: 1rem;" onclick="saveCategory()">Add Category</button>
                </div>
                
                <div class="category-list-section">
                    <h4 style="margin-bottom: 1rem; font-size: 0.9rem; font-weight: 600; color: var(--text-secondary);">YOUR CATEGORIES</h4>
                    <div id="categoryList" class="category-list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Category Modal -->
    <div class="modal" id="taskCategoryModal">
        <div class="modal-overlay" onclick="closeTaskCategoryModal()"></div>
        <div class="modal-box modal-box-large">
            <div class="modal-header">
                <h3>Manage Task Categories</h3>
                <button class="modal-close" onclick="closeTaskCategoryModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="category-form-section">
                    <h4 style="margin-bottom: 1rem; font-size: 0.9rem; font-weight: 600; color: var(--text-secondary);">ADD NEW CATEGORY</h4>
                    <input type="text" class="note-title-input" placeholder="Category name" id="taskCategoryName">
                    <label style="display: block; margin-top: 1rem; margin-bottom: 0.5rem; font-weight: 500;">Choose a color:</label>
                    <input type="color" id="taskCategoryColor" value="#3b82f6"
                        style="width: 100%; height: 50px; border-radius: 8px; border: 1px solid var(--border-color); cursor: pointer;">
                    <button class="btn-save" style="width: 100%; margin-top: 1rem;" onclick="saveTaskCategory()">Add Category</button>
                </div>
                
                <div class="category-list-section">
                    <h4 style="margin-bottom: 1rem; font-size: 0.9rem; font-weight: 600; color: var(--text-secondary);">YOUR CATEGORIES</h4>
                    <div id="taskCategoryList" class="category-list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Shopping Category Modal -->
    <div class="modal" id="shoppingCategoryModal">
        <div class="modal-overlay" onclick="closeShoppingCategoryModal()"></div>
        <div class="modal-box modal-box-large">
            <div class="modal-header">
                <h3>Manage Shopping Categories</h3>
                <button class="modal-close" onclick="closeShoppingCategoryModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="category-form-section">
                    <h4 style="margin-bottom: 1rem; font-size: 0.9rem; font-weight: 600; color: var(--text-secondary);">ADD NEW CATEGORY</h4>
                    <input type="text" class="note-title-input" placeholder="Category name" id="shoppingCategoryName">
                    <label style="display: block; margin-top: 1rem; margin-bottom: 0.5rem; font-weight: 500;">Choose a color:</label>
                    <input type="color" id="shoppingCategoryColor" value="#3b82f6"
                        style="width: 100%; height: 50px; border-radius: 8px; border: 1px solid var(--border-color); cursor: pointer;">
                    <button class="btn-save" style="width: 100%; margin-top: 1rem;" onclick="saveShoppingCategory()">Add Category</button>
                </div>
                
                <div class="category-list-section">
                    <h4 style="margin-bottom: 1rem; font-size: 0.9rem; font-weight: 600; color: var(--text-secondary);">YOUR CATEGORIES</h4>
                    <div id="shoppingCategoryList" class="category-list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Habit Category Modal -->
    <div class="modal" id="habitCategoryModal">
        <div class="modal-overlay" onclick="closeHabitCategoryModal()"></div>
        <div class="modal-box modal-box-large">
            <div class="modal-header">
                <h3>Manage Habit Categories</h3>
                <button class="modal-close" onclick="closeHabitCategoryModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="category-form-section">
                    <h4 style="margin-bottom: 1rem; font-size: 0.9rem; font-weight: 600; color: var(--text-secondary);">ADD NEW CATEGORY</h4>
                    <input type="text" class="note-title-input" placeholder="Category name" id="habitCategoryName">
                    <label style="display: block; margin-top: 1rem; margin-bottom: 0.5rem; font-weight: 500;">Choose a color:</label>
                    <input type="color" id="habitCategoryColor" value="#22c55e"
                        style="width: 100%; height: 50px; border-radius: 8px; border: 1px solid var(--border-color); cursor: pointer;">
                    <button class="btn-save" style="width: 100%; margin-top: 1rem;" onclick="saveHabitCategory()">Add Category</button>
                </div>
                
                <div class="category-list-section">
                    <h4 style="margin-bottom: 1rem; font-size: 0.9rem; font-weight: 600; color: var(--text-secondary);">YOUR CATEGORIES</h4>
                    <div id="habitCategoryList" class="category-list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ADDED: Habit Edit Modal -->
    <div class="modal" id="habitEditModal">
        <div class="modal-overlay" onclick="closeHabitEditModal()"></div>
        <div class="modal-box modal-box-large">
            <div class="modal-header">
                <h3>Edit Habit</h3>
                <button class="modal-close" onclick="closeHabitEditModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="edit-form-group">
                    <label>HABIT NAME</label>
                    <input type="text" id="editHabitInput" placeholder="e.g., Exercise, Read, Meditate...">
                </div>
                <div class="edit-form-group">
                    <label>CATEGORY</label>
                    <select id="editHabitCategory"></select>
                </div>
                <div class="edit-form-group">
                    <label>FREQUENCY</label>
                    <select id="editHabitFrequency" onchange="updateEditHabitDaySelectionVisibility()">
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                </div>

                <!-- Sub Habits -->
                <div class="edit-form-group">
                    <label>SUB-HABITS (OPTIONAL)</label>
                    <textarea 
                        id="editHabitSubHabits" 
                        placeholder="Enter each sub-habit on a new line"
                        rows="4"
                        style="resize: vertical; font-family: inherit;"
                    ></textarea>
                </div>
                
                <div id="editHabitDaySelector" class="day-selector" style="display: block;">
                    <div class="day-selector-header">
                        <span class="day-selector-title">Select Days for This Habit</span>
                        <span class="select-all-days" onclick="toggleAllEditHabitDays(true)">Select All</span>
                    </div>
                    <div class="day-checkboxes">
                        <input type="checkbox" id="edit-habit-day-sun" class="day-checkbox edit-habit-day-checkbox" value="sun">
                        <label for="edit-habit-day-sun" class="day-checkbox-label">
                            <span class="day-name">Sun</span>
                        </label>
                        <input type="checkbox" id="edit-habit-day-mon" class="day-checkbox edit-habit-day-checkbox" value="mon">
                        <label for="edit-habit-day-mon" class="day-checkbox-label">
                            <span class="day-name">Mon</span>
                        </label>
                        <input type="checkbox" id="edit-habit-day-tue" class="day-checkbox edit-habit-day-checkbox" value="tue">
                        <label for="edit-habit-day-tue" class="day-checkbox-label">
                            <span class="day-name">Tue</span>
                        </label>
                        <input type="checkbox" id="edit-habit-day-wed" class="day-checkbox edit-habit-day-checkbox" value="wed">
                        <label for="edit-habit-day-wed" class="day-checkbox-label">
                            <span class="day-name">Wed</span>
                        </label>
                        <input type="checkbox" id="edit-habit-day-thu" class="day-checkbox edit-habit-day-checkbox" value="thu">
                        <label for="edit-habit-day-thu" class="day-checkbox-label">
                            <span class="day-name">Thu</span>
                        </label>
                        <input type="checkbox" id="edit-habit-day-fri" class="day-checkbox edit-habit-day-checkbox" value="fri">
                        <label for="edit-habit-day-fri" class="day-checkbox-label">
                            <span class="day-name">Fri</span>
                        </label>
                        <input type="checkbox" id="edit-habit-day-sat" class="day-checkbox edit-habit-day-checkbox" value="sat">
                        <label for="edit-habit-day-sat" class="day-checkbox-label">
                            <span class="day-name">Sat</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeHabitEditModal()">Cancel</button>
                <button class="btn-save" onclick="saveHabitEdit()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- ADDED: Routine Edit Modal -->
    <div class="modal" id="routineEditModal">
        <div class="modal-overlay" onclick="closeRoutineEditModal()"></div>
        <div class="modal-box modal-box-large">
            <div class="modal-header">
                <h3>Edit Routine Activity</h3>
                <button class="modal-close" onclick="closeRoutineEditModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="edit-form-group">
                    <label>ACTIVITY NAME</label>
                    <input type="text" id="editRoutineInput" placeholder="e.g., Work, Morning Class, Gym...">
                </div>
                <div class="edit-form-group">
                    <label>START TIME</label>
                    <input type="time" id="editRoutineStartTime">
                </div>
                <div class="edit-form-group">
                    <label>END TIME</label>
                    <input type="time" id="editRoutineEndTime">
                </div>
                <div class="edit-form-group">
                    <label>DAYS OF THE WEEK</label>
                    <select id="editRoutineFrequency" onchange="updateEditRoutineDaySelectionVisibility()">
                        <option value="specific">Specific Days</option>
                        <option value="everyday">Every Day</option>
                        <option value="weekdays">Weekdays</option>
                        <option value="weekends">Weekends</option>
                    </select>
                </div>
                
                <div id="editRoutineDaySelector" class="day-selector" style="display: block;">
                    <div class="day-selector-header">
                        <span class="day-selector-title">Select Days</span>
                        <span class="select-all-days" onclick="toggleAllEditRoutineDays(true)">Select All</span>
                    </div>
                    <div class="day-checkboxes">
                        <input type="checkbox" id="edit-routine-day-sun" class="day-checkbox edit-routine-day-checkbox" value="sun">
                        <label for="edit-routine-day-sun" class="day-checkbox-label">
                            <span class="day-name">Sun</span>
                        </label>
                        <input type="checkbox" id="edit-routine-day-mon" class="day-checkbox edit-routine-day-checkbox" value="mon">
                        <label for="edit-routine-day-mon" class="day-checkbox-label">
                            <span class="day-name">Mon</span>
                        </label>
                        <input type="checkbox" id="edit-routine-day-tue" class="day-checkbox edit-routine-day-checkbox" value="tue">
                        <label for="edit-routine-day-tue" class="day-checkbox-label">
                            <span class="day-name">Tue</span>
                        </label>
                        <input type="checkbox" id="edit-routine-day-wed" class="day-checkbox edit-routine-day-checkbox" value="wed">
                        <label for="edit-routine-day-wed" class="day-checkbox-label">
                            <span class="day-name">Wed</span>
                        </label>
                        <input type="checkbox" id="edit-routine-day-thu" class="day-checkbox edit-routine-day-checkbox" value="thu">
                        <label for="edit-routine-day-thu" class="day-checkbox-label">
                            <span class="day-name">Thu</span>
                        </label>
                        <input type="checkbox" id="edit-routine-day-fri" class="day-checkbox edit-routine-day-checkbox" value="fri">
                        <label for="edit-routine-day-fri" class="day-checkbox-label">
                            <span class="day-name">Fri</span>
                        </label>
                        <input type="checkbox" id="edit-routine-day-sat" class="day-checkbox edit-routine-day-checkbox" value="sat">
                        <label for="edit-routine-day-sat" class="day-checkbox-label">
                            <span class="day-name">Sat</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeRoutineEditModal()">Cancel</button>
                <button class="btn-save" onclick="saveRoutineEdit()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- JavaScript Files - Load in correct order -->
    <script src="storage.js"></script>
    <script src="utils.js"></script>
    <script src="categories.js"></script>
    <script src="textEditor.js"></script>
    <script src="tasks.js"></script>
    <script src="to-buy.js"></script>
    <script src="ideas.js"></script>
    <script src="habits.js"></script>
    <script src="notes.js"></script>
    <script src="calendar.js"></script>
    <script src="events.js"></script>
    <script src="routine.js"></script>
    <script src="init.js"></script>
    
    <script>
    // Add escape key handler for edit modals
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            if (typeof closeTaskEditModal === 'function') closeTaskEditModal();
            if (typeof closeShoppingEditModal === 'function') closeShoppingEditModal();
            if (typeof closeIdeaEditModal === 'function') closeIdeaEditModal();
            if (typeof closeEventEditModal === 'function') closeEventEditModal();
        }
    });
    </script>
</body>

</html>